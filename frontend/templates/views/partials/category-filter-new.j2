{% do doc.styles.addCssFile('css/components/organisms/filter-bubbles-list.css') %}
{% do doc.styles.addCssFile('css/components/atoms/pill.css') %}

<div class="ap-o-filter-bubbles-list">
  <a class="ap-a-pill {% if 'All' not in filter_categories %}filtered{% endif %}" href="{{ doc.url.path }}#filter" name="all">
    {{ _('All') }}
  </a>
  {% for category, components in categories|sort %}
    {% set scope = namespace(categoryFormats=[]) %}
    {% for component in components %}
      {% set formats = component.formats or ['websites'] %}
      {% set scope.categoryFormats = scope.categoryFormats + formats %}
    {% endfor %}
    {% if category %}
      {% if format in scope.categoryFormats|unique|list|tojson %}
        {% set category_name = category.split('.')[1] if category and category.split('.')|length == 2 else category %}
        <a class="ap-a-pill {% if category_name|slug in filter_categories %}filtered{% endif %}" href="{{ doc.url.path }}?category={{ category_name|slug }}#filter" name="{{ _(category_name) }}">
          {{ _(category_name) }}
        </a>
      {% endif %}
    {% endif %}
  {% endfor %}
</div>
